#!/usr/bin/env bash
set -euo pipefail

echo "Stopping MySQL..."

if pgrep -x mysqld >/dev/null; then
  # ask nicely, then wait up to 30s
  pkill -TERM -x mysqld || true
  for _ in {1..30}; do
    pgrep -x mysqld >/dev/null || { echo "MySQL stopped."; exit 0; }
    sleep 1
  done
  echo "MySQL didnâ€™t stop in time; forcing..."
  pkill -KILL -x mysqld || true
else
  echo "mysqld not running; skipping."
fi

rm -rf /run/mysqld/*.sock /run/mysqld/*.sock.lock

exit 0
